<!doctype html>
<html lang="en" ng-app>
<head>
	<meta charset="utf-8">
	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
	<title>The Karma Show</title>
	<link rel="stylesheet" href="css/app.css"/>
	<script src="lib/jquery-2.0.3.min.js"></script>
	<script src="lib/jquery-ui-1.10.3.min.js"></script>
	<script src="lib/angular.min.js"></script>
	<script src="js/app.js"></script>
	<script src="js/controllers.js"></script>

	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "b642df4c-6fab-44a0-aa98-ecd96c607065", doNotHash: true, doNotCopy: false, hashAddressBar: false});</script>

</head>

<body ng-controller="KarmaShowCtrl">

	<div class="mainTitle" id="mainTitle">
		<div class="title">The Karma Show</div>	
		<div class="whiteline"></div>
		<div class="mainmenu">
			<table>
				<tr><th>Sort</th><th>Time</th><th>Subreddit</th></tr>
				<tr>
					<td id="sort">
						<div class="selected">Top</div>
						<div>Hot</div>
						<div>Comments</div>
					</td>
					<td id="t">
						<div class="selected">Week</div>
						<div>Day</div>
						<div>Month</div>
						<div>Year</div>
						<div>All</div>
					</td>
					<td id="subreddit">
						<div class="selected">All</div>
						<div ng-repeat="s in subreddits">{{s}}</div>
					</td>
				</tr>
			</table>
		</div>
	<div class="share">
		<span class='st_reddit_large' displayText='Reddit'></span>
		<span class='st_facebook_large' displayText='Facebook'></span>
		<span class='st_twitter_large' displayText='Tweet'></span>
	</div>
	</div>

	<div class="menubutton" onclick="showmenu()">&#9776;</div>

	<div class="videolist" id="videolist">
		<div class="hidevideos" onclick="hidevideos()"></div>
		<div class="videolisttitle">The video list</div>
		<ul class="images" id="images">
			<li ng-repeat="r in redditjson.data.children">
			<img height="100" id='{{r.data.name}}' src="{{r.data.media.oembed.thumbnail_url || r.data.thumbnail}}" title="{{r.data.title}}" alt="" onclick="loadVideo('{{r.data.name}}', '{{r.data.media.oembed.url}}');" />
			</li>
		</ul>
		<div class="loading" id="loading" ng-show="loading"><img src='pict/loading.gif' /></div>
	</div>

	<div class="showvideos" onclick="showvideos()"></div>

	<div align="center" class="videoplayer"><div id="player" /></div>
	<script src="http://www.youtube.com/player_api"></script>


	<script>
		var scrollpos = 0;
		var w = window,
		d = document,
		e = d.documentElement,
		g = d.getElementsByTagName('body')[0],
		x = w.innerWidth || e.clientWidth || g.clientWidth,
		y = w.innerHeight|| e.clientHeight|| g.clientHeight;

		var player;
		var currentplayed;

		function onYouTubeIframeAPIReady() {
			player = new YT.Player('player', {height: y, width: x, playerVars: {wmode: 'opaque'}, events: {'onStateChange':nextVideo } });
		}

		function loadVideo(name, url) {
			videoid = url.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/);
			player.loadVideoById(videoid[1]);
			currentplayed = name;
			$('#mainTitle').hide('puff');
			hidevideos();
		}

		function showvideos() {
			$('#videolist').show('slide', { direction: "up" }, 400, function() { $("#images").scrollLeft(scrollpos);  } );
			$("#images").scrollLeft(scrollpos);
		}
		
		function hidevideos() {
			scrollpos = $("#images").scrollLeft();
			$('#videolist').hide('slide', { direction: "up" }, 600);
		}

		function showmenu() {
			$('#mainTitle').show('puff');
			showvideos();
			player.pauseVideo();
		}

		function nextVideo(event) {
			if (event.data == 0) {
				//Play next video...
				$('#'+currentplayed).parent().next().children().click();
			}
		}

		$(window).resize(function () {
			$("iframe, player").height($(window).height());
			$("iframe, player").width($(window).width());
		});	

		$(document).ready(function() {
			$("div.mainmenu div").click(function(event) {
				$(event.target).parent().children().removeClass("selected");
				$(event.target).addClass("selected");
				var id = $(event.target).parent().attr('id');
				var value = $(event.target).text().toLowerCase();
				if (value=='all') { value = '*'; }
				$scope = angular.element($('body')).scope()
				$scope.$apply(function() {
					path = $scope.$location.path('')
					search = path.search();
					search[id] = value;
					path.search(search);
				});
				$scope.loadData();
			});
		});

	</script>
	
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-44340605-1', 'dabe.github.io');
		ga('send', 'pageview');

	</script>

</body>

</html>
